<!DOCTYPE html>
<html>
<head>
	<title>Agrismart dashboard</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
		integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
		crossorigin="" />
	<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
		integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
		crossorigin=""></script>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="/css/style.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Allerta+Stencil">
	<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
	<style>
		.w3-allerta {
			font-family: "Allerta Stencil", Sans-serif;
		}
	</style>
</head>
<body>
	<div class="w3-container w3-theme-l1 full-height">
		<div class="w3-black w3-center w3-allerta">
			<h3>Benvenuto <%= utente %></h3>
			<a href="http://localhost:<%= port %>/">HOME</a> -
			<a href="http://localhost:<%= port %>/logout">Logout</a>
			<div class="w3-right">
			</div>
		</div>
		<br>
		<div class="w3-row" >
			<div class="w3-container w3-half">
				<div class="w3-black w3-center w3-allerta">
					<h4>Campo: <%= nomecampo%></h4>
				</div>
				<pre>
		Coordinates: <%= lat %>, <%= lon %>
		Wheater:     <%= weather %>
		Temperatures:
			temp: <%= temp %>
			feels_like: <%= feels_like%>
			min: <%= min %>
			max: <%= max %>
			pressure: <%= pressure %>
			humidity: <%= humidity%>
				</pre>
			</div>
			<div class="w3-container w3-half">
				<!-- Dynamic map -->
				<div id="mapid" style="width: 600px; height: 400px;"></div>
			</div>
		</div>
		<br>
		<div class="w3-row">
			<div class="w3-container w3-half">
				<div class="w3-black w3-center w3-allerta">
					<h4>Sensori</h4>
				</div>
				<!-- Lista sensori -->
				<ul class="w3-ul w3-hoverable">
					<% for(var i in sensori) { %>
					<li class="w3-display-container">
						<p><%= sensori[i] %></p>
					</li>
					<% } %>
				</ul>
				<!-- Fine lista -->
				<div class="w3-container w3-right">
					<button id="addSensorButton" class="w3-button w3-xlarge w3-circle w3-red w3-card-4" onclick="showAddSensorForm()" title="Aggiungi un sensore">+</button>
				</div>
				<div class="w3-container w3-theme-l3" id="createSensorForm" style="visibility:hidden">
					<span onclick="hideAddSensorForm()" class="w3-button w3-right">&times;</span>
					<form action="/dashboard/addSensore" method="post">
						<label for="sensorID">Nome Sensore: </label>
						<input type="text" id="sensorID" name="sensorID"><br>
						<input type="text" id="campoID" name="campoID" value="<%= nomecampo%>" style="display: none"><br>
						<button type="submit" formmethod="post">Aggiungi</button>
					</form>
				</div>
			</div>
			<div class="w3-container w3-half">
				<div class="w3-black w3-center w3-allerta">
					<h4>Umidità registrata</h4>
				</div>
				<p>
					Qui ci sarà un bel grafico sull'umidità.
					Ma non è oggi il momento di metterlo
				</p>
			</div>
		</div>
	</div>

	<!-- Script per caricare la mappa -->
	<script>
		var mymap = L.map('mapid').setView(["<%= lat %>", "<%= lon %>"], 13);

		L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
				'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
			id: 'mapbox/streets-v11',
			tileSize: 512,
			zoomOffset: -1
		}).addTo(mymap);

		L.marker(["<%= lat %>", "<%= lon %>"]).addTo(mymap)
			.bindPopup("<b>Hey,</b><br />Il tuo campo è qui!").openPopup();

		mymap.on('click', onMapClick);

	</script>

	<!-- Funzioni JS per le interazioni sulla pagina -->
	<script>
		function showAddSensorForm() {
			document.getElementById("createSensorForm").style.visibility = "visible";
			document.getElementById("addSensorButton").style.visibility = "hidden";
		}

		function hideAddSensorForm(){
			document.getElementById("createSensorForm").style.visibility = "hidden";
			document.getElementById("addSensorButton").style.visibility = "visible";
		}
	</script>
</body>
</html>